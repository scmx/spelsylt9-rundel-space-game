var L=Object.defineProperty;var E=(n,t,e)=>t in n?L(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var r=(n,t,e)=>(E(n,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function e(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(s){if(s.ep)return;s.ep=!0;const a=e(s);fetch(s.href,a)}})();class w{constructor(){r(this,"time",0);r(this,"shooting",!1);r(this,"target")}}const I=class I{constructor(){r(this,"outer",{pos:{x:0,y:0},radius:3});r(this,"inner",{pos:{x:0,y:0},radius:1});r(this,"mid",{pos:{x:0,y:0},radius:0})}};r(I,"placeholder",new I);let u=I;function y(n,t){return Math.hypot(t.pos.x-n.pos.x,t.pos.y-n.pos.y)}function T(n,t){const e=y(n,t),i=n.radius+t.radius;return e<i}function m(n,t){const e=t.pos.x-n.pos.x,i=t.pos.y-n.pos.y;return Math.atan2(i,e)}const g=class g{constructor(){r(this,"pos",{x:0,y:0});r(this,"free",!0);r(this,"speed",g.normalSpeed);r(this,"target",u.placeholder.mid);r(this,"radius",0);r(this,"boundary",u.placeholder);r(this,"permeationTimer");r(this,"permeationInterval",2e3)}start(t){if(!this.free)return;this.free=!1,this.target=t,delete this.permeationTimer;const e=Math.random()*Math.PI*2,i=Math.cos(e)*3,s=Math.sin(e)*3;this.radius=Math.random()*.05+.01,this.speed=Math.random()*.001-5e-4+g.normalSpeed,this.pos.x=i,this.pos.y=s}draw(t){const{x:e,y:i,radius:s}=t.resolve(this);t.ctx.beginPath(),t.ctx.arc(e,i,s,0,Math.PI*2),t.ctx.closePath(),t.ctx.fillStyle=y(this,this.boundary.mid)+this.radius>this.boundary.inner.radius?"black":t.level.color,t.ctx.fill()}update(t){if(!this.permeationTimer&&T(this,this.boundary.inner)){this.permeationTimer=1;return}const e=this.permeationTimer?this.target:this.boundary.inner;if(this.permeationTimer&&this.permeationTimer<this.permeationInterval){this.permeationTimer+=t.time;return}const i=m(this,e),s=this.speed*t.time;this.pos.x+=Math.cos(i)*s,this.pos.y+=Math.sin(i)*s}};r(g,"normalSpeed",.001);let M=g;class d{constructor(t){this.color=t}static initArray(){return[new d("#fdd"),new d("#ddf"),new d("#dfd"),new d("#fdf"),new d("#ffd"),new d("#dff")]}}class j{constructor(t,e){r(this,"radius",.02);r(this,"shooting",!1);r(this,"target");r(this,"speed",3e-4);this.pos=t,this.boundary=e}draw(t){const{x:e,y:i,radius:s}=t.resolve(this);if(t.ctx.beginPath(),t.ctx.arc(e,i,s,0,Math.PI*2),t.ctx.closePath(),t.ctx.fillStyle=this.shooting?"red":"white",t.ctx.fill(),!this.target)return;const a=m(this,this.target),l=y(this,this.target),p=t.resolveRadius(l),h=t.resolve(this.target);t.ctx.beginPath();const o=(a-Math.PI/4)%(Math.PI*2),f=(a+Math.PI/4)%(Math.PI*2);t.ctx.arc(e,i,p,a,o,!0),t.ctx.moveTo(h.x,h.y),t.ctx.arc(e,i,p,a,f),t.ctx.moveTo(h.x,h.y),t.ctx.lineTo(e,i),t.ctx.moveTo(h.x,h.y),t.ctx.closePath(),t.ctx.lineWidth=4,t.ctx.setLineDash([4,64,4,96,4,192,4,352,4,576,4,864]),t.ctx.strokeStyle=this.shooting?"red":"white",t.ctx.stroke()}update(t){this.shooting=t.shooting,this.updatePosition(t)}updatePosition(t){if(!this.target||T(this.target,this))return;let e=m(this,this.target);this.pos.x+=Math.cos(e)*this.speed*t.time,this.pos.y+=Math.sin(e)*this.speed*t.time;const i=y(this,this.boundary.mid),s=this.boundary.inner.radius-this.radius;i<=s||(e=m(this.boundary.mid,this),this.pos.x=Math.cos(e)*s,this.pos.y=Math.sin(e)*s)}get targetAngle(){return this.target?m(this,this.target):0}}class S{constructor(t,e,i,s=!1){r(this,"items",[]);r(this,"timer",0);this.size=t,this.Klass=e,this.interval=i,this.autoFill=s;for(let a=0;a<this.size;a++){const l=new e;s&&l.start(),this.items.push(l)}}get values(){return this.items.values()}get idle(){return this.items.every(t=>t.free)}[Symbol.iterator](){return this.items.values()}getFree(){if(!(this.interval&&this.timer<this.interval))return this.timer=0,this.getFreeImmediate()}getFreeImmediate(){for(let t=0;t<this.items.length;t++)if(this.items[t].free)return this.items[t]}updatePoolTimer(t){this.interval&&(this.timer+=t.time)}}const b=class b{constructor(){r(this,"pos",{x:0,y:0});r(this,"free",!0);r(this,"angle",0);r(this,"speed",6e-4);r(this,"radius",b.normalRadius);r(this,"boundary",u.placeholder)}start(t,e,i,s){this.free&&(this.free=!1,this.pos.x=t.x,this.pos.y=t.y,this.radius=e,this.angle=i,this.boundary=s)}draw(t){if(this.free)return;const{x:e,y:i,radius:s}=t.resolve(this);t.ctx.beginPath(),t.ctx.arc(e,i,s,0,Math.PI*2),t.ctx.closePath(),t.ctx.fillStyle="gold",t.ctx.fill()}update(t){if(this.free)return;this.pos.x+=Math.cos(this.angle)*this.speed*t.time,this.pos.y+=Math.sin(this.angle)*this.speed*t.time;const e=y(this,this.boundary.mid),i=this.boundary.inner.radius+this.radius;e>=i&&(this.free=!0)}};r(b,"normalRadius",.01);let P=b;const z={x:0,y:0};class O{constructor(){r(this,"boundary",new u);r(this,"levels",d.initArray());r(this,"player");r(this,"enemies");r(this,"projectiles",new S(40,P,100));r(this,"levelIndex",0);const t=new URLSearchParams(location.search).has("easy")?4:40;this.enemies=new S(t,M,100);let e;try{const i=localStorage.getItem("rundel-space-game");i&&(e=JSON.parse(i))}catch{}typeof e=="object"&&e!=null&&typeof e.levelIndex=="number"&&(this.levelIndex=e.levelIndex%this.levels.length),console.log(this.boundary),this.player=new j(z,this.boundary),this.startLevel()}draw(t){this.drawOuter(t),this.drawInner(t),this.drawEnemies(t),this.player.draw(t),this.drawProjectiles(t)}drawOuter(t){t.ctx.fillStyle=this.level.color,t.ctx.fillRect(0,0,t.width,t.height)}drawInner(t){const{x:e,y:i,radius:s}=t.resolve(this.boundary.inner);t.ctx.beginPath(),t.ctx.arc(e,i,s,0,Math.PI*2),t.ctx.closePath(),t.ctx.fillStyle="black",t.ctx.fill()}drawEnemies(t){for(const e of this.enemies)e.free||e.draw(t)}drawProjectiles(t){for(const e of this.projectiles)e.free||e.draw(t)}update(t){this.updateProjectiles(t),this.updateEnemies(t),this.player.update(t)}updateEnemies(t){this.enemies.updatePoolTimer(t);for(const e of this.enemies)e.free||e.update(t)}updateProjectiles(t){var e;this.projectiles.updatePoolTimer(t);for(const i of this.projectiles)if(!i.free){i.update(t);for(const s of this.enemies)!s.free&&T(s,i)&&(s.free=!0)}this.enemies.idle&&(this.levelIndex=(this.levelIndex+1)%this.levels.length,localStorage.setItem("rundel-space-game",JSON.stringify({levelIndex:this.levelIndex})),this.startLevel()),!(!this.player.target||!t.shooting)&&((e=this.projectiles.getFree())==null||e.start(this.player.pos,P.normalRadius,this.player.targetAngle,this.boundary))}get level(){return this.levels[this.levelIndex]}startLevel(){for(const t of this.enemies)t.start(this.player)}}class A{constructor(t,e){r(this,"scale",0);r(this,"left",0);r(this,"top",0);r(this,"full",{width:0,height:0});r(this,"half",{width:0,height:0});r(this,"inner",{radius:0,left:0,top:0});this.ctx=t,this.game=e,this.resize()}resize(){let t=innerWidth,e=innerHeight-6;this.ctx.canvas.style.width=`${t}px`,this.ctx.canvas.style.height=`${e}px`,this.half.width=t,this.half.height=e,t*=2,e*=2,this.ctx.canvas.width=t,this.ctx.canvas.height=e,this.full.width=t,this.full.height=e;const i=.95;this.scale=Math.min(t,e)*i/2,[this.inner.left,this.inner.top]=t>e?[(t-e)/2*i,0]:[0,(e-t)/2*i],this.inner.radius=(t>e?e*i:t*i)/2,this.left=t/2,this.top=e/2}resolve(t){return{x:this.half.width+this.scale*t.pos.x,y:this.half.height+this.scale*t.pos.y,radius:this.scale*t.radius}}resolveRadius(t){return this.scale*t}pointersToTarget([t,e]){if(!t)return;if(!e)return{pos:this.mouseToPos(t),radius:0};const i=t.time<e.time?t:e;return{pos:this.mouseToPos(i),radius:0}}mouseToPos(t){return{x:(t.x*2-this.half.width)/this.scale,y:(t.y*2-this.half.height)/this.scale}}get width(){return this.canvas.width}get height(){return this.canvas.height}get canvas(){return this.ctx.canvas}get level(){return this.game.level}}function D(){const n=canvas1.getContext("2d"),t=new O,e=new A(n,t);console.log(t);const i=new w,s=new Map,a=new Set;let l=0;function p(o){t.draw(e),i.time=o-l,l=o,i.shooting=a.has("Space")||s.size>1,t.player.target=e.pointersToTarget([...s.values()]),t.update(i),requestAnimationFrame(p)}requestAnimationFrame(p),n.canvas.addEventListener("pointerdown",o=>{const{pressure:f,x,y:v}=o;s.set(o.pointerId,{pressure:f,x,y:v,time:Date.now()})}),n.canvas.addEventListener("pointermove",o=>{const{pressure:f,x,y:v}=o,c=s.get(o.pointerId);c?(c.x=x,c.y=v,c.pressure=c.pressure,c.time??(c.time=Date.now())):s.set(o.pointerId,{pressure:f,x,y:v,time:Date.now()})}),n.canvas.addEventListener("pointerup",o=>{s.delete(o.pointerId)}),n.canvas.addEventListener("pointercancel",o=>{s.delete(o.pointerId)}),n.canvas.addEventListener("pointerleave",o=>{s.delete(o.pointerId)}),addEventListener("keydown",o=>{o.code==="Space"&&a.add("Space")}),addEventListener("keyup",o=>{o.code==="Space"&&a.delete("Space")}),addEventListener("blur",()=>{a.clear()}),addEventListener("resize",()=>{e.resize()}),addEventListener("orientationchange",()=>{e.resize()}),addEventListener("touchstart",h,{passive:!1}),addEventListener("touchmove",h,{passive:!1}),addEventListener("contextmenu",h,{passive:!1}),addEventListener("selectstart",h,{passive:!1}),addEventListener("selectionchange",h,{passive:!1});function h(o){o.preventDefault()}}addEventListener("load",()=>{D()});
